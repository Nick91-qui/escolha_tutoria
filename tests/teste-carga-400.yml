# teste-carga-400.yml
config:
  target: "http://localhost:3000"
  processor: "./teste-carga-tutoria.js"
  phases:
    # Fase 1: Aquecimento suave
    - duration: 30
      arrivalRate: 2
      name: "Aquecimento inicial"

    # Fase 2: Aumento gradual
    - duration: 60
      arrivalRate: 5
      rampTo: 15
      name: "Aumento gradual"

    # Fase 3: Carga moderada
    - duration: 120
      arrivalRate: 15
      maxVusers: 100
      name: "Carga moderada"

    # Fase 4: Pico controlado
    - duration: 60
      arrivalRate: 20
      maxVusers: 150
      name: "Pico controlado"

  plugins:
    metrics-by-endpoint: {}
    expect: {}

  http:
    timeout: 30
    pool: 20

scenarios:
  - name: "Fluxo completo de escolha de tutores"
    flow:
      - function: "selecionarAluno"
      
      # Aumentar intervalo entre requisições
      - think: 3

      - post:
          url: "/api/verificar-aluno"
          json:
            turma: "{{ turma }}"
            nome: "{{ nome }}"
          expect:
            - statusCode: 200
          afterResponse: "registrarEstatisticas"

      - think: 5

      - post:
          url: "/api/preferencias"
          json:
            turma: "{{ turma }}"
            nome: "{{ nome }}"
            preferencias: "{{ preferencias }}"
          expect:
            - statusCode: 200
          afterResponse: "registrarEstatisticas"

      - think: 2