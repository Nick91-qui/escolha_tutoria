# inscricoes-csv.yml
config:
  target: "http://http://172.25.179.159/:3000"
  processor: "./processador-csv.js"
  phases:
    - duration: 30
      arrivalRate: 1
      maxVusers: 3
      name: "Teste de carga"
  plugins:
    expect: {}

scenarios:
  - name: "Fluxo de escolha de tutoria"
    flow:
      # Inicialização
      - function: "inicializarDados"
      
      # Verificação do aluno
      - post:
          url: "/api/verificar-aluno"
          json:
            turma: "{{ turma }}"
            nome: "{{ nome }}"
          capture:
            - json: "$"
              as: "verificacao"
          expect:
            - statusCode: 200
      - think: 1

      # Envio das preferências
      - post:
          url: "/api/preferencias"
          json:
            turma: "{{ turma }}"
            nome: "{{ nome }}"
            preferencias: "{{ preferencias }}"
          capture:
            - json: "$"
              as: "resultado"
          afterResponse: "registrarResultado"
      - think: 2